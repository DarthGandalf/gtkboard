/*  This file is a part of gtkboard, a board games system.
    Copyright (C) 2003, Arvind Narayanan <arvindn@users.sourceforge.net>

    This program is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program; if not, write to the Free Software
    Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA 02111 USA

*/
#include <stdio.h>
#include <string.h>
#include <assert.h>
#include <stdlib.h>
#include <time.h>
#include <gdk/gdkkeysyms.h>


#include "game.h"
#include "../pixmaps/alpha.xpm"


#define FLW_CELL_SIZE 36

#define FLW_NUM_PIECES 26

#define FLW_BOARD_WID 4
#define FLW_BOARD_HEIT 6

#define FLW_LEN 4

char flw_colors[9] = {0xd7, 0xd7, 0xd7, 0xd7, 0xd7, 0xd7, 0, 0, 0xff};

static char **flw_pixmaps [] = 
{
	char_A_grey_36_36_xpm,
	char_B_grey_36_36_xpm,
	char_C_grey_36_36_xpm,
	char_D_grey_36_36_xpm,
	char_E_grey_36_36_xpm,
	char_F_grey_36_36_xpm,
	char_G_grey_36_36_xpm,
	char_H_grey_36_36_xpm,
	char_I_grey_36_36_xpm,
	char_J_grey_36_36_xpm,
	char_K_grey_36_36_xpm,
	char_L_grey_36_36_xpm,
	char_M_grey_36_36_xpm,
	char_N_grey_36_36_xpm,
	char_O_grey_36_36_xpm,
	char_P_grey_36_36_xpm,
	char_Q_grey_36_36_xpm,
	char_R_grey_36_36_xpm,
	char_S_grey_36_36_xpm,
	char_T_grey_36_36_xpm,
	char_U_grey_36_36_xpm,
	char_V_grey_36_36_xpm,
	char_W_grey_36_36_xpm,
	char_X_grey_36_36_xpm,
	char_Y_grey_36_36_xpm,
	char_Z_grey_36_36_xpm,
};

SCORE_FIELD flw_score_fields[] = {SCORE_FIELD_USER, SCORE_FIELD_TIME, SCORE_FIELD_DATE, SCORE_FIELD_NONE};
char *flw_score_field_names[] = {"User", "Time", "Date", NULL};


/* This list was generated using
   $ egrep -x [a-z]{4} /usr/share/dict/words
 */
static const char *words[] = 
{
	"abbe",
	"abed",
	"abet",
	"able",
	"ably",
	"abut",
	"aces",
	"ache",
	"acid",
	"acme",
	"acne",
	"acre",
	"adds",
	"afar",
	"agar",
	"aged",
	"ager",
	"ages",
	"agog",
	"ague",
	"aide",
	"aids",
	"aims",
	"airs",
	"airy",
	"ajar",
	"akin",
	"alas",
	"alba",
	"alee",
	"alga",
	"ally",
	"alma",
	"alms",
	"aloe",
	"also",
	"alum",
	"amen",
	"amid",
	"ammo",
	"amok",
	"amyl",
	"anal",
	"anew",
	"anon",
	"ante",
	"anti",
	"ants",
	"anus",
	"aped",
	"apes",
	"apex",
	"apse",
	"aqua",
	"arch",
	"arcs",
	"area",
	"arid",
	"arms",
	"army",
	"arts",
	"asks",
	"atom",
	"atop",
	"aunt",
	"aura",
	"auto",
	"aver",
	"avid",
	"avow",
	"away",
	"awed",
	"awls",
	"awry",
	"axed",
	"axer",
	"axes",
	"axis",
	"axle",
	"axon",
	"ayes",
	"babe",
	"baby",
	"back",
	"bade",
	"bags",
	"bail",
	"bait",
	"bake",
	"bald",
	"bale",
	"balk",
	"ball",
	"balm",
	"band",
	"bane",
	"bang",
	"bank",
	"bans",
	"barb",
	"bard",
	"bare",
	"bark",
	"barn",
	"bars",
	"base",
	"bash",
	"bask",
	"bass",
	"bath",
	"bats",
	"baud",
	"bawl",
	"bays",
	"bead",
	"beak",
	"beam",
	"bean",
	"bear",
	"beat",
	"beau",
	"beck",
	"beds",
	"beef",
	"been",
	"beep",
	"beer",
	"bees",
	"beet",
	"begs",
	"bell",
	"belt",
	"bely",
	"bend",
	"bent",
	"best",
	"beta",
	"bets",
	"bevy",
	"bias",
	"bibs",
	"bide",
	"bids",
	"bier",
	"bike",
	"bile",
	"bilk",
	"bill",
	"bind",
	"bing",
	"bins",
	"bird",
	"bite",
	"bits",
	"blab",
	"bled",
	"blew",
	"blip",
	"blob",
	"bloc",
	"blot",
	"blow",
	"blue",
	"blur",
	"boar",
	"boat",
	"bobs",
	"bode",
	"body",
	"bogs",
	"boil",
	"bold",
	"boll",
	"bolt",
	"bomb",
	"bond",
	"bone",
	"bong",
	"bony",
	"boob",
	"book",
	"boom",
	"boon",
	"boor",
	"boos",
	"boot",
	"bore",
	"born",
	"boss",
	"both",
	"bout",
	"bowl",
	"bows",
	"boys",
	"brae",
	"brag",
	"bran",
	"bras",
	"brat",
	"bray",
	"bred",
	"brew",
	"brig",
	"brim",
	"brow",
	"buck",
	"buds",
	"buff",
	"bugs",
	"bulb",
	"bulk",
	"bull",
	"bump",
	"bums",
	"bunk",
	"buns",
	"bunt",
	"buoy",
	"burl",
	"burn",
	"burp",
	"bury",
	"bush",
	"buss",
	"bust",
	"busy",
	"butt",
	"buys",
	"buzz",
	"byte",
	"cabs",
	"cafe",
	"cage",
	"cake",
	"calf",
	"call",
	"calm",
	"came",
	"camp",
	"cane",
	"cans",
	"cant",
	"cape",
	"caps",
	"card",
	"care",
	"carp",
	"cars",
	"cart",
	"case",
	"cash",
	"cask",
	"cast",
	"cats",
	"cave",
	"cede",
	"cell",
	"cent",
	"chap",
	"char",
	"chat",
	"chef",
	"chew",
	"chic",
	"chin",
	"chip",
	"chit",
	"chop",
	"chum",
	"cite",
	"city",
	"clad",
	"clam",
	"clan",
	"clap",
	"claw",
	"clay",
	"clip",
	"clod",
	"clog",
	"clot",
	"club",
	"clue",
	"coal",
	"coat",
	"coax",
	"coca",
	"cock",
	"coco",
	"code",
	"coed",
	"cogs",
	"coil",
	"coin",
	"coke",
	"cold",
	"colt",
	"comb",
	"come",
	"cone",
	"cook",
	"cool",
	"coon",
	"coop",
	"cope",
	"cops",
	"copy",
	"cord",
	"core",
	"cork",
	"corn",
	"cost",
	"cosy",
	"cots",
	"cove",
	"cowl",
	"cows",
	"cozy",
	"crab",
	"crag",
	"cram",
	"crew",
	"crib",
	"crop",
	"crow",
	"crud",
	"crux",
	"cube",
	"cubs",
	"cued",
	"cues",
	"cuff",
	"cull",
	"cult",
	"cups",
	"curb",
	"curd",
	"cure",
	"curl",
	"curs",
	"curt",
	"cusp",
	"cute",
	"cuts",
	"cyst",
	"czar",
	"dads",
	"dale",
	"dame",
	"damn",
	"damp",
	"dams",
	"dare",
	"dark",
	"darn",
	"dart",
	"dash",
	"data",
	"date",
	"dawn",
	"days",
	"daze",
	"dead",
	"deaf",
	"deal",
	"dean",
	"dear",
	"debt",
	"deck",
	"deed",
	"deem",
	"deep",
	"deer",
	"defy",
	"dell",
	"demo",
	"dens",
	"dent",
	"deny",
	"desk",
	"deus",
	"dewy",
	"dial",
	"dice",
	"died",
	"diem",
	"dies",
	"diet",
	"digs",
	"dike",
	"dill",
	"dime",
	"dims",
	"dine",
	"ding",
	"dint",
	"dips",
	"dire",
	"dirt",
	"disc",
	"dish",
	"disk",
	"dive",
	"dock",
	"doer",
	"does",
	"dogs",
	"dole",
	"doll",
	"dome",
	"done",
	"dons",
	"doom",
	"door",
	"dope",
	"dose",
	"dote",
	"dots",
	"dove",
	"down",
	"doze",
	"drab",
	"drag",
	"dram",
	"draw",
	"drew",
	"drip",
	"drop",
	"drug",
	"drum",
	"dual",
	"dubs",
	"duck",
	"duct",
	"duel",
	"dues",
	"duet",
	"duke",
	"dull",
	"duly",
	"dumb",
	"dump",
	"dune",
	"dung",
	"dunk",
	"dupe",
	"dusk",
	"dust",
	"duty",
	"dyad",
	"dyed",
	"dyer",
	"dyes",
	"dyne",
	"each",
	"earl",
	"earn",
	"ears",
	"ease",
	"east",
	"easy",
	"eats",
	"ebbs",
	"echo",
	"eddy",
	"edge",
	"edit",
	"eels",
	"eggs",
	"egos",
	"eked",
	"ekes",
	"elks",
	"elms",
	"else",
	"emit",
	"ends",
	"envy",
	"epic",
	"eras",
	"ergo",
	"errs",
	"espy",
	"etch",
	"even",
	"ever",
	"evil",
	"ewes",
	"exam",
	"exec",
	"exit",
	"eyed",
	"eyer",
	"eyes",
	"face",
	"fact",
	"fade",
	"fags",
	"fail",
	"fain",
	"fair",
	"fake",
	"fall",
	"fame",
	"fang",
	"fans",
	"fare",
	"farm",
	"fast",
	"fate",
	"fats",
	"faun",
	"fawn",
	"faze",
	"fear",
	"feat",
	"feed",
	"feel",
	"fees",
	"feet",
	"fell",
	"felt",
	"fend",
	"fern",
	"feud",
	"fiat",
	"fief",
	"fife",
	"figs",
	"file",
	"fill",
	"film",
	"find",
	"fine",
	"fink",
	"fins",
	"fire",
	"firm",
	"fish",
	"fist",
	"fits",
	"five",
	"flag",
	"flak",
	"flam",
	"flap",
	"flat",
	"flaw",
	"flax",
	"flea",
	"fled",
	"flee",
	"flew",
	"flex",
	"flip",
	"flit",
	"flog",
	"flop",
	"flow",
	"flue",
	"flux",
	"foal",
	"foam",
	"foci",
	"foes",
	"fogs",
	"fogy",
	"foil",
	"fold",
	"folk",
	"fond",
	"font",
	"food",
	"fool",
	"foot",
	"ford",
	"fore",
	"fork",
	"form",
	"fort",
	"foul",
	"four",
	"fowl",
	"fray",
	"free",
	"fret",
	"frog",
	"from",
	"fuel",
	"full",
	"fume",
	"fund",
	"funk",
	"furs",
	"fury",
	"fuse",
	"fuss",
	"fuzz",
	"gags",
	"gain",
	"gait",
	"gale",
	"gall",
	"game",
	"gang",
	"gape",
	"gaps",
	"garb",
	"gash",
	"gasp",
	"gate",
	"gave",
	"gawk",
	"gaze",
	"gear",
	"geld",
	"gels",
	"gems",
	"gene",
	"gent",
	"germ",
	"gets",
	"gift",
	"gild",
	"gill",
	"gilt",
	"gins",
	"gird",
	"girl",
	"girt",
	"gist",
	"give",
	"glad",
	"glee",
	"glen",
	"glow",
	"glue",
	"glut",
	"gnat",
	"gnaw",
	"goad",
	"goal",
	"goat",
	"gods",
	"goes",
	"gold",
	"golf",
	"gone",
	"gong",
	"good",
	"goof",
	"gore",
	"gory",
	"gosh",
	"gout",
	"gown",
	"grab",
	"grad",
	"gram",
	"gray",
	"grew",
	"grey",
	"grid",
	"grim",
	"grin",
	"grip",
	"grit",
	"grow",
	"grub",
	"gulf",
	"gull",
	"gulp",
	"gums",
	"guns",
	"guru",
	"gush",
	"gust",
	"guts",
	"guys",
	"gyro",
	"hack",
	"hail",
	"hair",
	"hale",
	"half",
	"hall",
	"halt",
	"hams",
	"hand",
	"hang",
	"hard",
	"hare",
	"hark",
	"harm",
	"harp",
	"hart",
	"hash",
	"hate",
	"hats",
	"haul",
	"have",
	"hawk",
	"haze",
	"hazy",
	"head",
	"heal",
	"heap",
	"hear",
	"heat",
	"heck",
	"heed",
	"heel",
	"heir",
	"held",
	"hell",
	"helm",
	"help",
	"hemp",
	"hems",
	"hens",
	"herb",
	"herd",
	"here",
	"hero",
	"hers",
	"hews",
	"hick",
	"hide",
	"high",
	"hike",
	"hill",
	"hilt",
	"hind",
	"hint",
	"hips",
	"hire",
	"hiss",
	"hits",
	"hive",
	"hoar",
	"hoes",
	"hogs",
	"hold",
	"hole",
	"holy",
	"home",
	"homo",
	"hone",
	"hood",
	"hoof",
	"hook",
	"hoop",
	"hoot",
	"hope",
	"hops",
	"horn",
	"hose",
	"host",
	"hour",
	"howl",
	"hubs",
	"hues",
	"huge",
	"hull",
	"hump",
	"hums",
	"hung",
	"hunk",
	"hunt",
	"hurl",
	"hurt",
	"hush",
	"husk",
	"huts",
	"hymn",
	"ibex",
	"ibid",
	"ibis",
	"iced",
	"ices",
	"icon",
	"idea",
	"idem",
	"idle",
	"idly",
	"idol",
	"ills",
	"illy",
	"imps",
	"inch",
	"inks",
	"inns",
	"into",
	"ions",
	"iota",
	"ires",
	"iris",
	"irks",
	"iron",
	"isle",
	"itch",
	"item",
	"jabs",
	"jack",
	"jade",
	"jail",
	"jams",
	"jars",
	"jaws",
	"jazz",
	"jean",
	"jeep",
	"jeer",
	"jerk",
	"jest",
	"jets",
	"jigs",
	"jobs",
	"jogs",
	"join",
	"joke",
	"jolt",
	"jots",
	"joys",
	"judo",
	"jugs",
	"jump",
	"junk",
	"jure",
	"jury",
	"just",
	"keel",
	"keen",
	"keep",
	"kept",
	"kern",
	"keys",
	"kick",
	"kids",
	"kill",
	"kind",
	"king",
	"kink",
	"kiss",
	"kite",
	"kits",
	"knee",
	"knew",
	"knit",
	"knob",
	"knot",
	"know",
	"kudo",
	"labs",
	"lace",
	"lack",
	"lacy",
	"lads",
	"lady",
	"lags",
	"laid",
	"lain",
	"lair",
	"lake",
	"lamb",
	"lame",
	"lamp",
	"land",
	"lane",
	"laps",
	"lard",
	"lark",
	"lash",
	"lass",
	"last",
	"late",
	"lava",
	"lawn",
	"laws",
	"lays",
	"lazy",
	"lead",
	"leaf",
	"leak",
	"lean",
	"leap",
	"leek",
	"leer",
	"lees",
	"left",
	"legs",
	"lend",
	"lens",
	"lent",
	"less",
	"lest",
	"lets",
	"levy",
	"lewd",
	"liar",
	"lice",
	"lick",
	"lids",
	"lied",
	"lien",
	"lies",
	"lieu",
	"life",
	"lift",
	"like",
	"lily",
	"limb",
	"lime",
	"limp",
	"line",
	"link",
	"lint",
	"lion",
	"lips",
	"lisp",
	"list",
	"live",
	"load",
	"loaf",
	"loan",
	"lobe",
	"loci",
	"lock",
	"loft",
	"logo",
	"logs",
	"loin",
	"lone",
	"long",
	"look",
	"loom",
	"loon",
	"loop",
	"loot",
	"lord",
	"lore",
	"lose",
	"loss",
	"lost",
	"lots",
	"loud",
	"lout",
	"love",
	"lows",
	"luck",
	"lull",
	"lump",
	"lung",
	"lure",
	"lurk",
	"lush",
	"lust",
	"lute",
	"lynx",
	"lyre",
	"mace",
	"made",
	"maid",
	"mail",
	"maim",
	"main",
	"make",
	"male",
	"mall",
	"malt",
	"mama",
	"mane",
	"many",
	"maps",
	"mare",
	"mark",
	"mart",
	"mash",
	"mask",
	"mass",
	"mast",
	"mate",
	"math",
	"mats",
	"maul",
	"maze",
	"mead",
	"meal",
	"mean",
	"meat",
	"meek",
	"meet",
	"melt",
	"memo",
	"mend",
	"mens",
	"menu",
	"mere",
	"mesh",
	"mess",
	"meta",
	"mete",
	"mets",
	"mews",
	"mica",
	"mice",
	"mien",
	"mike",
	"mild",
	"mile",
	"milk",
	"mill",
	"mind",
	"mine",
	"mini",
	"mink",
	"mint",
	"mire",
	"miss",
	"mist",
	"moan",
	"moat",
	"mobs",
	"mock",
	"mode",
	"mold",
	"mole",
	"monk",
	"mood",
	"moot",
	"mops",
	"more",
	"morn",
	"moss",
	"most",
	"moth",
	"move",
	"mows",
	"much",
	"muck",
	"muff",
	"mugs",
	"mule",
	"mull",
	"mung",
	"muse",
	"mush",
	"musk",
	"must",
	"mute",
	"mutt",
	"myth",
	"nags",
	"nail",
	"name",
	"naps",
	"nary",
	"navy",
	"near",
	"neat",
	"neck",
	"need",
	"neon",
	"nest",
	"nets",
	"newt",
	"next",
	"nice",
	"nick",
	"nigh",
	"nine",
	"nips",
	"node",
	"nods",
	"none",
	"nook",
	"noon",
	"norm",
	"nose",
	"note",
	"noun",
	"nude",
	"null",
	"numb",
	"nuns",
	"nuts",
	"oaks",
	"oars",
	"oath",
	"oats",
	"obey",
	"oboe",
	"odds",
	"odes",
	"odor",
	"offs",
	"oils",
	"oily",
	"okay",
	"oldy",
	"omen",
	"omit",
	"once",
	"ones",
	"only",
	"onto",
	"onus",
	"onyx",
	"ooze",
	"opal",
	"open",
	"opts",
	"opus",
	"oral",
	"ores",
	"orgy",
	"ouch",
	"ours",
	"oust",
	"outs",
	"oval",
	"oven",
	"over",
	"owed",
	"owes",
	"owls",
	"owns",
	"oxen",
	"pace",
	"pack",
	"pact",
	"pads",
	"page",
	"paid",
	"pail",
	"pain",
	"pair",
	"pale",
	"pall",
	"palm",
	"pals",
	"pane",
	"pang",
	"pans",
	"pant",
	"papa",
	"pare",
	"park",
	"pars",
	"part",
	"pass",
	"past",
	"pate",
	"path",
	"pats",
	"pave",
	"pawn",
	"paws",
	"pays",
	"peak",
	"peal",
	"pear",
	"peas",
	"peat",
	"peck",
	"peek",
	"peel",
	"peep",
	"peer",
	"pegs",
	"pelt",
	"pend",
	"pens",
	"pent",
	"perk",
	"pest",
	"pets",
	"pews",
	"pica",
	"pick",
	"pier",
	"pies",
	"pigs",
	"pike",
	"pile",
	"pill",
	"pimp",
	"pine",
	"ping",
	"pink",
	"pins",
	"pint",
	"pion",
	"pipe",
	"piss",
	"pith",
	"pits",
	"pity",
	"plan",
	"play",
	"plea",
	"plod",
	"plot",
	"plow",
	"ploy",
	"plug",
	"plum",
	"plus",
	"pods",
	"poem",
	"poet",
	"pogo",
	"poke",
	"pole",
	"poll",
	"polo",
	"pomp",
	"pond",
	"pong",
	"pony",
	"pool",
	"poor",
	"pops",
	"pore",
	"pork",
	"port",
	"pose",
	"posh",
	"post",
	"pots",
	"pour",
	"pout",
	"pray",
	"prep",
	"prey",
	"prim",
	"prod",
	"prop",
	"pros",
	"prow",
	"pubs",
	"puff",
	"puke",
	"pull",
	"pulp",
	"puma",
	"pump",
	"puns",
	"punt",
	"puny",
	"pupa",
	"pups",
	"pure",
	"purr",
	"push",
	"puss",
	"puts",
	"putt",
	"pyre",
	"quad",
	"quay",
	"quip",
	"quit",
	"quiz",
	"race",
	"rack",
	"raft",
	"rage",
	"rags",
	"raid",
	"rail",
	"rain",
	"rake",
	"ramp",
	"rams",
	"rang",
	"rank",
	"rant",
	"rape",
	"raps",
	"rapt",
	"rare",
	"rash",
	"rasp",
	"rate",
	"rats",
	"rave",
	"rays",
	"raze",
	"read",
	"real",
	"ream",
	"reap",
	"rear",
	"redo",
	"reds",
	"reed",
	"reef",
	"reel",
	"rein",
	"rely",
	"rend",
	"rent",
	"rest",
	"ribs",
	"rice",
	"rich",
	"ride",
	"rids",
	"rift",
	"rigs",
	"rill",
	"rime",
	"rims",
	"rind",
	"ring",
	"rink",
	"riot",
	"ripe",
	"rips",
	"rise",
	"risk",
	"rite",
	"road",
	"roam",
	"roar",
	"robe",
	"robs",
	"rock",
	"rode",
	"rods",
	"role",
	"roll",
	"romp",
	"roof",
	"rook",
	"room",
	"root",
	"rope",
	"rosy",
	"rots",
	"rout",
	"rove",
	"rows",
	"rubs",
	"ruby",
	"rude",
	"rugs",
	"ruin",
	"rule",
	"rump",
	"rung",
	"runs",
	"runt",
	"rush",
	"rust",
	"ruts",
	"sack",
	"safe",
	"saga",
	"sage",
	"sags",
	"said",
	"sail",
	"sake",
	"sale",
	"salt",
	"same",
	"sand",
	"sane",
	"sang",
	"sank",
	"saps",
	"sari",
	"sash",
	"sate",
	"save",
	"saws",
	"says",
	"scab",
	"scan",
	"scar",
	"scow",
	"scud",
	"seal",
	"seam",
	"sear",
	"seas",
	"seat",
	"sect",
	"seed",
	"seek",
	"seem",
	"seen",
	"seep",
	"seer",
	"sees",
	"self",
	"sell",
	"semi",
	"send",
	"sent",
	"sept",
	"serf",
	"sets",
	"sews",
	"sexy",
	"sham",
	"shed",
	"shin",
	"ship",
	"shit",
	"shod",
	"shoe",
	"shop",
	"shot",
	"show",
	"shun",
	"shut",
	"sick",
	"side",
	"sift",
	"sigh",
	"sign",
	"silk",
	"sill",
	"silo",
	"silt",
	"sine",
	"sing",
	"sink",
	"sins",
	"sips",
	"sire",
	"sirs",
	"site",
	"sits",
	"situ",
	"size",
	"skew",
	"skid",
	"skim",
	"skin",
	"skip",
	"skis",
	"skit",
	"slab",
	"slam",
	"slap",
	"slat",
	"slay",
	"sled",
	"slew",
	"slid",
	"slim",
	"slip",
	"slit",
	"slob",
	"slop",
	"slot",
	"slow",
	"slug",
	"slum",
	"slur",
	"smog",
	"smug",
	"smut",
	"snag",
	"snap",
	"snip",
	"snob",
	"snow",
	"snub",
	"snug",
	"soak",
	"soap",
	"soar",
	"sobs",
	"sock",
	"soda",
	"sods",
	"sofa",
	"soft",
	"soil",
	"sold",
	"sole",
	"solo",
	"some",
	"song",
	"sons",
	"soon",
	"soot",
	"sore",
	"sort",
	"soul",
	"soup",
	"sour",
	"sown",
	"soya",
	"span",
	"spat",
	"spec",
	"sped",
	"spin",
	"spit",
	"spot",
	"spun",
	"spur",
	"stab",
	"stag",
	"star",
	"stay",
	"stem",
	"step",
	"stew",
	"stir",
	"stop",
	"stow",
	"stub",
	"stud",
	"stun",
	"subs",
	"such",
	"suck",
	"suds",
	"sued",
	"sues",
	"suit",
	"sulk",
	"sums",
	"sung",
	"sunk",
	"suns",
	"sure",
	"surf",
	"swab",
	"swam",
	"swan",
	"swap",
	"swat",
	"sway",
	"swim",
	"swum",
	"tabs",
	"tack",
	"tact",
	"tags",
	"tail",
	"take",
	"tale",
	"talk",
	"tall",
	"tame",
	"tang",
	"tank",
	"tape",
	"taps",
	"tart",
	"task",
	"taut",
	"taxi",
	"team",
	"tear",
	"teas",
	"teem",
	"teen",
	"tell",
	"tend",
	"tens",
	"tent",
	"term",
	"test",
	"text",
	"than",
	"that",
	"thaw",
	"them",
	"then",
	"they",
	"thin",
	"this",
	"thud",
	"thug",
	"thus",
	"tick",
	"tide",
	"tidy",
	"tied",
	"tier",
	"ties",
	"tile",
	"till",
	"tilt",
	"time",
	"tins",
	"tint",
	"tiny",
	"tips",
	"tire",
	"tits",
	"toad",
	"toes",
	"toil",
	"told",
	"toll",
	"tomb",
	"tone",
	"tons",
	"took",
	"tool",
	"tops",
	"tore",
	"torn",
	"toss",
	"tour",
	"town",
	"toys",
	"trap",
	"tray",
	"tree",
	"trek",
	"trim",
	"trio",
	"trip",
	"trod",
	"trot",
	"true",
	"tube",
	"tubs",
	"tuck",
	"tuft",
	"tugs",
	"tune",
	"turf",
	"turn",
	"twas",
	"twig",
	"twin",
	"twos",
	"type",
	"typo",
	"ugly",
	"undo",
	"unit",
	"unto",
	"upon",
	"urge",
	"urns",
	"used",
	"user",
	"uses",
	"vain",
	"vale",
	"vane",
	"vans",
	"vary",
	"vase",
	"vast",
	"vats",
	"veal",
	"veer",
	"veil",
	"vein",
	"vent",
	"verb",
	"very",
	"vest",
	"veto",
	"vial",
	"vice",
	"vied",
	"vier",
	"vies",
	"view",
	"vile",
	"vine",
	"visa",
	"vita",
	"void",
	"volt",
	"vote",
	"vows",
	"wade",
	"waft",
	"wage",
	"wags",
	"wail",
	"wait",
	"wake",
	"walk",
	"wall",
	"wand",
	"wane",
	"want",
	"ward",
	"ware",
	"warm",
	"warn",
	"warp",
	"wars",
	"wart",
	"wary",
	"wash",
	"wasp",
	"wave",
	"waxy",
	"ways",
	"weak",
	"wean",
	"wear",
	"webs",
	"weds",
	"weed",
	"week",
	"weep",
	"weld",
	"well",
	"went",
	"wept",
	"were",
	"west",
	"wets",
	"what",
	"when",
	"whim",
	"whip",
	"whit",
	"whiz",
	"whom",
	"wick",
	"wide",
	"wife",
	"wigs",
	"wild",
	"wile",
	"will",
	"wilt",
	"wily",
	"wind",
	"wine",
	"wing",
	"wink",
	"wins",
	"wipe",
	"wire",
	"wiry",
	"wise",
	"wish",
	"wisp",
	"with",
	"wits",
	"woke",
	"wolf",
	"womb",
	"wont",
	"wood",
	"woof",
	"wool",
	"woos",
	"word",
	"wore",
	"work",
	"worm",
	"worn",
	"wove",
	"wrap",
	"wren",
	"writ",
	"yank",
	"yard",
	"yarn",
	"yawn",
	"year",
	"yeas",
	"yell",
	"yelp",
	"yoke",
	"your",
	"zeal",
	"zero",
	"zest",
	"zinc",
	"zone",
	"zoom",
	"zoos",
};

static const int nWords = sizeof (words) / sizeof (words[0]);

static int flw_wordcmp (const void *p1, const void *p2)
{
	return strcmp ((char *)p1, *(char **)p2);
}

void flw_find_chain (char chain[FLW_LEN+1][FLW_LEN+1])
{
	int i, j, idx, found;
	int done[FLW_LEN];
	char word[FLW_LEN+1];
	srand (time (0));
	do
	{
		strncpy (word, words[rand() % nWords], FLW_LEN+1);
		sprintf (chain[0], "%s", word);
		for (i=0, memset (done, 0, FLW_LEN * sizeof (int)); i<FLW_LEN; i++)
		{
			char orig;
			do {idx = rand() % FLW_LEN;} while (done[idx]); done[idx] = 1;
			orig= word[idx];
			for (j=0, found=0; j<100; j++)
			{
				if ((word[idx] = rand() % 26 + 'a') == orig) continue;
				if (bsearch (word, words, nWords, sizeof (words[0]), flw_wordcmp))
				{
					sprintf (chain[i+1], "%s", word);
					found = 1; 
					break;
				}
			}
			if (!found)
				break;
		}
	}
	while (!found);
}

static void flw_init ();
int flw_getmove (Pos *, int, int, GtkboardEventType, Player, byte **);
int flw_getmove_kb (Pos *, int, Player, byte **);
void flw_free ();
ResultType flw_who_won (Pos *, Player , char **);

Game Flw = { FLW_CELL_SIZE, FLW_BOARD_WID, FLW_BOARD_HEIT, 
	FLW_NUM_PIECES, 
	flw_colors, NULL, flw_pixmaps, 
	"Four Letter Words", 
	flw_init};


static char flw_chain[FLW_LEN+1][FLW_LEN+1];


static void flw_setinitpos (Pos *pos)
{
	int i, j;
	for (i=0; i<board_wid * board_heit; i++)
		pos->board[i] = 0;
	flw_find_chain (flw_chain);
	for (i=0; i<FLW_LEN; i++)
	{
		pos->board[(board_heit - 1) * board_wid + i] = flw_chain[0][i] - 'a' + 1;
		pos->board[i] = flw_chain[FLW_LEN][i] - 'a' + 1;
	}
}

static void flw_init ()
{
	game_single_player = TRUE;
	game_setinitpos = flw_setinitpos;
	game_draw_cell_boundaries = TRUE;
	game_free = flw_free;
	game_getmove = flw_getmove;
	game_getmove_kb = flw_getmove_kb;
	game_who_won = flw_who_won;
	game_start_immediately = TRUE;
	game_scorecmp = game_scorecmp_def_iscore;
	game_score_fields = flw_score_fields;
	game_score_field_names = flw_score_field_names;
	game_doc_about = 
		"Four letter words\n"
		"Single player game\n"
		"Status: Partially implemented (playable)\n"
		"URL: "GAME_DEFAULT_URL("flw");
	game_doc_rules = 
		" Four Letter Words rules\n\n"
		" This is a simple game in which the objective is to change the word at the top to the word at the bottom by changing one letter at a time. All intermediate words must be legal.\n"
		" To start playing, hit enter. This will make a copy of the top word on the second row. Click on the letter you want to change and change it by typing the new letter. Now hit enter. Repeat until all the rows are filled.";
}

static int flw_curx = -1, flw_cury = -1;

ResultType flw_who_won (Pos *pos, Player to_play, char **commp)
{
	static char comment[32] = "You won.";
	int i;
	for (i=0; i<FLW_LEN; i++)
		if (pos->board [i] != pos->board [board_wid + i])
			return RESULT_NOTYET;
	*commp = comment;
	return RESULT_WON;
}

int flw_getmove (Pos *pos, int x, int y, GtkboardEventType type, Player to_play, 
		byte **movp)
{
	if (type != GTKBOARD_BUTTON_RELEASE)
		return 0;
	if (y == 0 || y == board_heit - 1) return 0;
	if (pos->board [y * board_wid + x] == 0) return 0;
	flw_curx = x;
	flw_cury = y;
	return 0;
}

int flw_getmove_kb (Pos *pos, int key, Player glob_to_play, byte **movp)
{
	static byte move[10];
	byte *mp = move;
	int i, j, cury;
	char word[FLW_LEN+1], prevword[FLW_LEN+1];
	if (flw_cury >= 0)
	{
		if (!(pos->board [flw_cury * board_wid] &&
				(pos->board [(flw_cury-1) * board_wid] == 0 || flw_cury == 1)))
		{
			// find the current row
			for (j = board_heit - 1; j>=0 && pos->board[j * board_wid]; j--)
				;
			if (j < 0) j = 0;
			flw_cury = j+1;
			flw_curx = 0;
		}
	}
	if (key == GDK_Return)
	{
		if ((cury = flw_cury) < 0)
			cury = board_heit - 1;
		for (i=0; i<FLW_LEN; i++)
		{
			word[i] = pos->board [cury * board_wid + i] + 'a' - 1;
			if (flw_cury >= 0)
				prevword[i] = pos->board [(cury+1) * board_wid + i] + 'a' - 1;
		}
		word[FLW_LEN] = '\0';
		prevword[FLW_LEN] = '\0';
		if (!bsearch (word, words, nWords, sizeof (words[0]), flw_wordcmp))
			return -1;
		if (flw_cury >= 0)
		{
			int diffcnt = 0;
			for (i=0; i<FLW_LEN; i++)
				if (word[i] != prevword[i])
					diffcnt++;
			if (diffcnt != 1)
				return -1;			
		}
		if (flw_cury < 0)
		{
			flw_curx = 0;
			flw_cury = board_heit - 1;
		}
		flw_cury --;
		for (i=0; i<FLW_LEN; i++)
		{
			*mp++ = i; *mp++ = flw_cury; *mp++ = word[i] - 'a' + 1;
		}
		*mp++ = -1;
		*movp = move;
		return 1;
	}
	if (flw_cury < 0 || flw_cury == board_heit - 1)
		return -1;
	if (key == GDK_Right)
	{
		if (++flw_curx == FLW_LEN) flw_curx = 0;
		return 0;
	}
	if (key == GDK_Left)
	{
		if (--flw_curx < 0) flw_curx = FLW_LEN - 1;
		return 0;
	}
	if (key >= GDK_A && key <= GDK_Z)
		key = key + GDK_a - GDK_A;
	if (key >= GDK_a && key <= GDK_z)
	{
			*mp++ = flw_curx; *mp++ = flw_cury; *mp++ = key - GDK_a + 1;
			*mp++ = -1;
			*movp = move;
			return 1;
	}
	return -1;
}

void flw_free ()
{
	flw_curx = flw_cury = -1;
}

